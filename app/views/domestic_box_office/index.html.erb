<h1>Domestic Box Office</h1>

<!-- Form to filter by Monthly or Yearly -->
<%= form_with(url: filter_domestic_box_office_path, method: :get, local: true) do |f| %>
  <!-- Select Monthly or Yearly -->
  <%= label_tag :filter_type, "Filter By" %>
  <%= select_tag :filter_type, options_for_select([["Monthly", "monthly"], ["Yearly", "yearly"]], params[:filter_type] || "monthly"), id: "filter_type_select" %>

  <!-- Year Filter (shown for both monthly and yearly) -->
  <%= label_tag :year, "Year" %>
  <%= select_tag :year, options_for_select(
    (2000..Date.today.year).to_a.reverse, 
    params[:year] || Date.today.year
  ) %>

  <!-- Month Filter (only shown if Monthly is selected) -->
  <div id="month_filter" style="<%= params[:filter_type] == 'yearly' ? 'display:none;' : '' %>">
    <%= label_tag :month, "Month" %>
    <%= select_tag :month, options_for_select(
      [["January", 1], ["February", 2], ["March", 3], ["April", 4], ["May", 5], 
      ["June", 6], ["July", 7], ["August", 8], ["September", 9], 
      ["October", 10], ["November", 11], ["December", 12]], 
      params[:month] || Date.today.month
    ) %>
  </div>

  <!-- Release Scale Filter (only shown if Yearly is selected) -->
  <div id="release_scale_filter" style="<%= params[:filter_type] == 'monthly' ? 'display:none;' : '' %>">
    <%= label_tag :release_scale, "Release Type" %>
    <%= select_tag :release_scale, options_for_select([["All", "all"], ["Wide Releases", "wide"], ["Limited Releases", "limited"]], params[:release_scale] || "all") %>
  </div>

  <%= submit_tag "Filter" %>
<% end %>

<!-- Display the movie data -->
<% if @movies.any? %>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Title</th>
        <th>Domestic Gross Revenue</th>
        <th>Total Theaters</th>
        <th>Total Gross Revenue</th>
        <th>Release Date</th>
        <th>Distributor</th>
      </tr>
    </thead>
    <tbody>
      <% @movies.each do |movie| %>
        <tr>
          <td><%= movie[:rank] %></td>
          <td><%= movie[:title] %></td>
          <td><%= number_to_currency(movie[:domestic_gross]) %></td>
          <td><%= movie[:total_theaters] %></td>
          <td><%= number_to_currency(movie[:total_gross]) %></td>
          <td><%= movie[:release_date] %></td>
          <td><%= movie[:distributor] %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No data available for the selected filter.</p>
<% end %>

<script>
  // Show/Hide filters based on Monthly or Yearly selection
  document.getElementById('filter_type_select').addEventListener('change', function() {
    var filterType = this.value;
    document.getElementById('month_filter').style.display = (filterType === 'monthly') ? '' : 'none';
    document.getElementById('release_scale_filter').style.display = (filterType === 'yearly') ? '' : 'none';
  });
</script>
